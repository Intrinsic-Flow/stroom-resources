version: "3"

services:

  stroom-proxy:
    image: gchq/stroom-proxy:latest
    ports:
      - 8085:8085

  stroom-stats:
    image: gchq/stroom-stats:latest
    # Stroom-stats in a container is configured by setting environment variables.
    # What's shown below is the minimum configuration for production. Everything else has sensible defaults.
    #
    # Probably the only environment variables that will need setting for development are STATS_DB_URL and STATS_ZK_QUORUM.
    #
    # The environment variables are transposed into the Dropwizard config file (stroom-stats-service/config.yml).
    # See that file for other settable environment variables.
    #
    # The ../../bin/runDeploy.sh script replaces the <TOKENS> with actual values.
    environment:
      - STATS_DB_USER=stroomuser
      - STATS_DB_PASSWORD=stroompassword1
      - STATS_DB_URL=jdbc:mysql://<STATS_DB_IP>:3307/stroom?useUnicode=yes&characterEncoding=UTF-8
      - STATS_JWT_SECRET={"kty":"RSA","kid":"k1","n":"uMF7JkZQDWvC9N0T1sw__7Tdaq0L34ghFBrKq7CkW-LiibQXh3eXBJtNPriDZ7QT4wA23jDF6Bq28RhEyWSssCqrm1Fjvq2ck5dd1shrqR-9WXBs0T1gXi4Mbne3aiWSWFHyW17qjEFoQfx9tLAX9eJYR56KpEu7Au6PAL_9ThQFlQy9wx5Dss8SQy6uwA9qw9A9lCGJKDhRwwBlXZ_5mJSWqqjNSz7ptIKAWvjOVTG8MmgOKqme9RLnWpQnNRf6h9ILK4wixAYLMQpIRphc9tFlZdhiy2yqcdiAEktCF7U0ZcnY3fN_-dw-VEHaCdUoBAPNqBsDPx9ewB8-wtyApQ","e":"AQAB"}
      - STATS_ZK_QUORUM=<STATS_ZK_IP>:2181
      - STATS_KAFKA_BOOTSTRAP=<KAFKA_IP>:9092
      - STATS_HBASE_ZK_QUORUM=<HBASE_ZK_IP>:2181
      - ADMIN_CONTEXT_PATH=/stats/admin
    ports:
      - 8086:8086
      - 8087:8087
    extra_hosts:
      - hbase:<HBASE_ZK_IP>
      - kafka:<KAFKA_IP>

  stroom-auth-service:
    image: gchq/stroom-auth-service:latest
    environment:
      - DB_USER=stroomuser
      - DB_PASSWORD=stroompassword1
      - DB_URL=jdbc:mysql://<USER_DB_IP>:3307/stroom?useUnicode=yes&characterEncoding=UTF-8
      - JWS_VERIFICATION_KEY={"kty":"RSA","kid":"k1","n":"uMF7JkZQDWvC9N0T1sw__7Tdaq0L34ghFBrKq7CkW-LiibQXh3eXBJtNPriDZ7QT4wA23jDF6Bq28RhEyWSssCqrm1Fjvq2ck5dd1shrqR-9WXBs0T1gXi4Mbne3aiWSWFHyW17qjEFoQfx9tLAX9eJYR56KpEu7Au6PAL_9ThQFlQy9wx5Dss8SQy6uwA9qw9A9lCGJKDhRwwBlXZ_5mJSWqqjNSz7ptIKAWvjOVTG8MmgOKqme9RLnWpQnNRf6h9ILK4wixAYLMQpIRphc9tFlZdhiy2yqcdiAEktCF7U0ZcnY3fN_-dw-VEHaCdUoBAPNqBsDPx9ewB8-wtyApQ","e":"AQAB","d":"b22RvoXNpiqGDHSBkJzjRG9q0vnHHWvWt29pKJ-CoUB3bKHHRxajaE3aCqfx6Mu86r2oWd2EnvXtu_7tDaHAXQd_NE-kHs5KjuFN4UpDVF8mLhkWKCQiSOrw6Hcfkc9TMh1KVD0srKaOIK4Nirph2RRINfmymGBsS9phOQyR01JNInQuDYNSgoDT-Uv1PjzHwD3AuJgiDV37OlASbAGGsb3LQQNUAuBIU6Hqo_hb7RZmi7P5QJnvsiMRr99TlFBoRfVrrFz4TCxQ24FidHGdSbCRW3vMku16zFYdoH1YZzNhkH0SzMunI2Gb2kOok7HSnY40vG9d0dXR7pxg6_2niQ","p":"5_w4aycxflrmrrm1lJjRU0MCvuQA5vY563E-iUKJvALh0WUOgyD_POsMWCYhQtk0nsCk6cMOakGwEauDNgNHgqXU7wA5VyRozZQI6ksf3e_FIqbuf37xfRVEV7XzGLq0l-g0bjG5DDGQW6Nv_61JDmyp-e_Yl-7rZbFNNKNk2Wc","q":"y-GlO8LXW8ymJDuBopC5BUVcwRx9rKOYgOyHu5Ds2X9w6JdB_fVRnua_cjkzaWhCKNfBOAnapnHms9SMCvYf69cSJh5xh5-IU7ngiw_EtBBMMUIZY1OQ_h8VIslrZEkEO7qQia8txW8_zgssbmyYFHc1O0QQ3tMm-2ZRwEkb8hM","dp":"VzHlHtlvb_fIxxnEV2MNIseIK6nVcPpRkN5SzBK3ZHSM3kCmsMDhTstmK2fBjrfHYHg2RCrtqyCfhjS6L74Rzdh47ZBe_RMRVVvz8eRkyO2LYlfuQvu61vH8ax9XjQ74PDSqKFUGIcAra1ZGDYrbb9GGHgx5k7nYvrNiuotDp7c","dq":"FpUQszTam71oLZ01t6bmB3JuWqloNiYMr0MDqb_crB6Uh_6w_Ysdlkcir2ksi6FTqqhzK1zUDhmRnxuMw24NjRbOWNCIbKg79mIhP-XoOLWRaudSXpET_0G8GpVKwtnfkSoR9l4j6LlwzMaqDjUTBzlI-R6J69RhffkQVwcCBGc","qi":"hnETo3IUbiqhIzvmRUUBAjD3IgFxjhNEGCQ7jTtGAcghowFtl_AKg6R80IAsA1EJNBcii7vUE3GePiFCkgGUfQrm3P-ovmI4rmD7xJcpZpnNyYVLJQWYlu4gOow__R_uLffmHYQIakjPe7BTEDqxl1VVGP1k3sm1avI4xF2QvdA"}
      - ADMIN_CONTEXT_PATH=/auth/admin
    ports:
      - 8096:8096
      - 8097:8097

  stroom-auth-ui:
    image: gchq/stroom-auth-ui:latest
    environment:
      - REACT_APP_STROOM_AUTH_SERVICE_URL=http://stroom-auth-service:8096
      - REACT_APP_STROOM_UI_URL=http://localhost:8080
    ports:
      - 5000:5000
