#Runs the whole stroom estate
version: '2'

services:

  nginx:
      extends:
          file: ./containers/nginx.yml
          service: nginx

  zookeeper:
      extends:
          file: ./containers/zookeeper.yml
          service: zookeeper

  stroom-db:
      extends:
          file: ./containers/stroomDb.yml
          service: stroom-db

  stroom-stats-db:
      extends:
          file: ./containers/stroomStatsDb.yml
          service: stroom-stats-db

  stroom-annotations-db:
    extends:
          file: ./containers/stroomAnnotationsDb.yml
          service: stroom-annotations-db

  stroom-annotations-service:
      extends:
          file: ./containers/stroomAnnotationsService.yml
          service: stroom-annotations-service

  stroom-annotations-ui:
      extends:
          file: ./containers/stroomAnnotationsUi.yml
          service: stroom-annotations-ui

  stroom-auth-service-db:
      extends:
          file: ./containers/stroomAuthDb.yml
          service: stroom-auth-service-db

  kafka:
      extends:
          file: ./containers/kafka.yml
          service: kafka
      depends_on:
        - zookeeper

  elasticsearch:
    extends:
      file: ./containers/elasticsearch.yml
      service: elasticsearch

  kibana:
    extends:
      file: ./containers/kibana.yml
      service: kibana
    depends_on:
      - elasticsearch

  hbase:
      extends:
          file: ./containers/hbase.yml
          service: hbase
      #override the hostname as stroom-stats will access it from inside the docker network
      #hostname: hbase
      depends_on:
        - zookeeper

  stroom-stats:
      extends:
          file: ./containers/stroomStats.yml
          service: stroom-stats
      depends_on:
        - stroom-db
        - zookeeper
        - kafka
        - hbase

#  stroom-proxy:
#      extends:
#          file: ./containers/stroomProxy.yml
#          service: stroom-proxy

  stroom:
      extends:
          file: ./containers/stroom.yml
          service: stroom
      depends_on:
        - stroom-db
        - stroom-stats-db
        - zookeeper
        - kafka